{
  "functions": [
    {
      "name": "matrix_multiply",
      "args": [
        {"name": "A", "type": {"ptr": "int"}},
        {"name": "B", "type": {"ptr": "int"}},
        {"name": "C", "type": {"ptr": "int"}},
        {"name": "N", "type": "int"}
      ],
      "instrs": [
        {"op": "const", "type": "int", "value": 0, "dest": "i"},
        {
          "op": "loop",
          "args": ["i", "N"],
          "body": {
            "instrs": [
              {"op": "const", "type": "int", "value": 0, "dest": "j"},
              {
                "op": "loop",
                "args": ["j", "N"],
                "body": {
                  "instrs": [
                    {"op": "const", "type": "int", "value": 0, "dest": "sum"},
                    {"op": "const", "type": "int", "value": 0, "dest": "k"},
                    {
                      "op": "loop",
                      "args": ["k", "N"],
                      "body": {
                        "instrs": [
                          {"op": "mul", "args": ["i", "N"], "dest": "idx1", "type": "int"},
                          {"op": "add", "args": ["idx1", "k"], "dest": "idx_a", "type": "int"},
                          {"op": "mul", "args": ["k", "N"], "dest": "idx2", "type": "int"},
                          {"op": "add", "args": ["idx2", "j"], "dest": "idx_b", "type": "int"},
                          {"op": "load", "args": ["A", "idx_a"], "dest": "a_val", "type": "int"},
                          {"op": "load", "args": ["B", "idx_b"], "dest": "b_val", "type": "int"},
                          {"op": "mul", "args": ["a_val", "b_val"], "dest": "prod", "type": "int"},
                          {"op": "add", "args": ["sum", "prod"], "dest": "sum", "type": "int"}
                        ]
                      }
                    },
                    {"op": "mul", "args": ["i", "N"], "dest": "idx3", "type": "int"},
                    {"op": "add", "args": ["idx3", "j"], "dest": "idx_c", "type": "int"},
                    {"op": "store", "args": ["C", "idx_c", "sum"]}
                  ]
                }
              }
            ]
          }
        }
      ]
    },
    {
      "name": "fusion_candidate",
      "args": [
        {"name": "A", "type": {"ptr": "int"}},
        {"name": "B", "type": {"ptr": "int"}},
        {"name": "N", "type": "int"}
      ],
      "instrs": [
        {"op": "const", "type": "int", "value": 0, "dest": "i"},
        {
          "op": "loop",
          "args": ["i", "N"],
          "body": {
            "instrs": [
              {"op": "load", "args": ["A", "i"], "dest": "val", "type": "int"},
              {"op": "const", "type": "int", "value": 2, "dest": "two"},
              {"op": "mul", "args": ["val", "two"], "dest": "doubled", "type": "int"},
              {"op": "store", "args": ["B", "i", "doubled"]}
            ]
          }
        },
        {"op": "const", "type": "int", "value": 0, "dest": "j"},
        {
          "op": "loop",
          "args": ["j", "N"],
          "body": {
            "instrs": [
              {"op": "load", "args": ["B", "j"], "dest": "val", "type": "int"},
              {"op": "const", "type": "int", "value": 3, "dest": "three"},
              {"op": "add", "args": ["val", "three"], "dest": "increased", "type": "int"},
              {"op": "store", "args": ["B", "j", "increased"]}
            ]
          }
        }
      ]
    },
    {
      "name": "stencil_1d",
      "args": [
        {"name": "input", "type": {"ptr": "int"}},
        {"name": "output", "type": {"ptr": "int"}},
        {"name": "N", "type": "int"}
      ],
      "instrs": [
        {"op": "const", "type": "int", "value": 1, "dest": "i"},
        {
          "op": "loop",
          "args": ["i", "N"],
          "body": {
            "instrs": [
              {"op": "sub", "args": ["i", "1"], "dest": "idx_prev", "type": "int"},
              {"op": "load", "args": ["input", "idx_prev"], "dest": "prev", "type": "int"},
              {"op": "load", "args": ["input", "i"], "dest": "curr", "type": "int"},
              {"op": "add", "args": ["i", "1"], "dest": "idx_next", "type": "int"},
              {"op": "load", "args": ["input", "idx_next"], "dest": "next", "type": "int"},
              {"op": "add", "args": ["prev", "curr"], "dest": "sum1", "type": "int"},
              {"op": "add", "args": ["sum1", "next"], "dest": "sum2", "type": "int"},
              {"op": "const", "type": "int", "value": 3, "dest": "divisor"},
              {"op": "div", "args": ["sum2", "divisor"], "dest": "avg", "type": "int"},
              {"op": "store", "args": ["output", "i", "avg"]}
            ]
          }
        }
      ]
    }
  ]
}
